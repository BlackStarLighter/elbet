<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELBET - Strop Filigran</title>
    <style>
        :root {
            --primary: #ff5f2e;
            --bg: #050505;
            --panel-bg: rgba(18, 18, 18, 0.95);
            --font: 'Segoe UI', Roboto, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font); }
        body { background: var(--bg); color: white; overflow: hidden; height: 100vh; }

        .ui-container-left {
            position: absolute; top: 25px; left: 25px; 
            display: flex; flex-direction: column; 
            gap: 10px; 
            z-index: 100; width: 360px;
        }

        .side-panel, .info-panel {
            background: var(--panel-bg); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px; padding: 25px;
            opacity: 0; transform: translateX(-30px); transition: 1.2s cubic-bezier(0.22, 1, 0.36, 1);
            backdrop-filter: blur(15px);
        }

        .side-panel.visible, .info-panel.visible { opacity: 1; transform: translateX(0); }

        h1 { font-size: 13px; color: var(--primary); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px; font-weight: 900; }
        .label { font-size: 10px; color: #888; text-transform: uppercase; margin-bottom: 10px; display: block; font-weight: 700; }
        
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .variant-btn {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            color: #ccc; padding: 12px; border-radius: 10px; cursor: pointer; transition: 0.3s; font-size: 11px; font-weight: 600;
        }
        .variant-btn.active { border-color: var(--primary); color: white; background: rgba(255, 95, 46, 0.15); }

        .info-panel { display: flex; flex-direction: column; position: relative; max-height: 500px; }
        
        .info-content { 
            font-size: 11px; line-height: 1.6; color: #aaa; 
            overflow-y: scroll;
            scrollbar-width: none;
            -ms-overflow-style: none;
            scroll-behavior: smooth;
        }
        .info-content::-webkit-scrollbar { display: none; }

        .info-item { margin-bottom: 15px; padding-left: 12px; position: relative; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 10px; }
        .info-item::before { content: '•'; position: absolute; left: 0; color: var(--primary); font-weight: bold; }
        .info-tag { color: #eee; font-weight: 600; display: block; margin-bottom: 2px; text-transform: uppercase; font-size: 9px; }

        .scroll-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .scroll-arrow {
            color: var(--primary); font-size: 18px; font-weight: bold; width: 30px; height: 30px; line-height: 30px; text-align: center; cursor: pointer; user-select: none; transition: 0.3s;
        }
        .scroll-arrow:hover { color: white; transform: scale(1.2); }
        .arrow-up { transform: rotate(-90deg); }
        .arrow-down { transform: rotate(90deg); }

        .control-section { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; margin-top: 15px; }
        .ui-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .modern-slider { width: 100%; height: 4px; background: #333; border-radius: 10px; -webkit-appearance: none; appearance: none; outline: none; margin: 10px 0; }
        .modern-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: var(--primary); border-radius: 50%; cursor: pointer; border: 2px solid #fff; }

        .switch { position: relative; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider-round { position: absolute; cursor: pointer; inset: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider-round:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider-round { background-color: var(--primary); }
        input:checked + .slider-round:before { transform: translateX(22px); }

        .ar-container { position: absolute; bottom: 45px; left: 50%; transform: translateX(-50%); z-index: 100; opacity: 0; transition: 1.5s; }
        .ar-container.visible { opacity: 1; }
        .btn-ar { background: linear-gradient(135deg, #ff7e54, #ff5f2e); color: white; border: none; padding: 20px 50px; border-radius: 50px; font-weight: 800; font-size: 14px; cursor: pointer; box-shadow: 0 10px 30px rgba(255, 95, 46, 0.4); }
        
        .nav-guide {
            position: absolute; bottom: 35px; right: 35px;
            background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 20px 30px; z-index: 100;
            display: flex; gap: 30px; opacity: 0; transition: 1.5s; backdrop-filter: blur(10px);
        }
        .nav-guide.visible { opacity: 1; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .mouse-icon { width: 24px; height: 38px; border: 2px solid #555; border-radius: 12px; position: relative; }
        .mouse-icon::before { content: ''; position: absolute; top: 6px; left: 50%; transform: translateX(-50%); width: 4px; height: 8px; background: #555; border-radius: 2px; }
        .mouse-left::after { content: ''; position: absolute; top: 0; left: 0; width: 50%; height: 40%; background: var(--primary); border-top-left-radius: 10px; }
        .mouse-right::after { content: ''; position: absolute; top: 0; right: 0; width: 50%; height: 40%; background: var(--primary); border-top-right-radius: 10px; }
        .mouse-scroll::before { background: var(--primary); top: 8px; z-index: 2; }
        .nav-text { font-size: 10px; color: #888; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }

        #start-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: opacity 0.5s; }
    </style>
</head>
<body>

    <div id="start-overlay" onclick="startExperience()">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#ff5f2e" stroke-width="0.3"><path d="M5 3l14 9-14 9V3z"/></svg>
        <p style="color: var(--primary); font-size: 12px; letter-spacing: 6px; margin-top: 30px; font-weight: 300;">URUCHOM PREZENTACJĘ PRODUKTU</p>
    </div>

    <div class="ui-container-left">
        <div class="side-panel" id="ui-panel">
            <h1>Specyfikacja Techniczna</h1>
            <span class="label">Całkowita Grubość Stropu (H)</span>
            <div class="btn-grid">
                <button class="variant-btn active" onclick="setVariant(16, this)">160 mm</button>
                <button class="variant-btn" onclick="setVariant(18, this)">180 mm</button>
                <button class="variant-btn" onclick="setVariant(20, this)">200 mm</button>
                <button class="variant-btn" onclick="setVariant(22, this)">220 mm</button>
            </div>
            <div class="control-section">
                <div class="ui-row">
                    <span class="label" style="margin:0">Tryb X-Ray (Zbrojenie)</span>
                    <label class="switch">
                        <input type="checkbox" id="xrayToggle" onchange="toggleXRay(this.checked)">
                        <span class="slider-round"></span>
                    </label>
                </div>
                <span class="label">Przekrój konstrukcyjny</span>
                <input type="range" id="clipSlider" class="modern-slider" min="-8" max="8" step="0.1" value="8" oninput="updateClipping(this.value)">
            </div>
        </div>

        <div class="info-panel" id="info-panel">
            <h1>Kompendium: Strop Filigran</h1>
            <div class="info-content" id="scrollContainer">
                <div class="info-item"><span class="info-tag">Definicja Systemu:</span> Strop typu Filigran to system zespolony, składający się z prefabrykowanej płyty żelbetowej o grubości 5-7 cm oraz warstwy betonu wylewanego na budowie (nadbetonu).</div>
                
                <div class="info-item"><span class="info-tag">Zbrojenie Kratowe:</span> Charakterystycznym elementem są przestrzenne kratownice stalowe, które wystają z płyty prefabrykowanej. Zapewniają one sztywność montażową oraz doskonałe zespolenie z nadbetonem.</div>
                
                <div class="info-item"><span class="info-tag">Eliminacja Deskowań:</span> Płyta Filigran pełni funkcję szalunku traconego. Znacznie ogranicza to ilość drewna szalunkowego i stemplowania, co przyspiesza prace o ok. 50%.</div>
                
                <div class="info-item"><span class="info-tag">Gładka Powierzchnia:</span> Spodnia strona płyty jest gładka i nie wymaga tynkowania – wystarczy szpachlowanie połączeń, co redukuje koszty wykończenia wnętrz.</div>
                
                <div class="info-item"><span class="info-tag">Elastyczność Projektowa:</span> System pozwala na dowolne kształtowanie rzutu stropu (wycięcia, skosy, otwory instalacyjne), które są przygotowywane już na etapie produkcji prefabrykatu.</div>
                
                <div class="info-item"><span class="info-tag">Nośność i Rozpiętość:</span> Stropy Filigran pozwalają na uzyskanie dużych rozpiętości (nawet do 10-12 metrów) przy zachowaniu stosunkowo małej grubości konstrukcji.</div>
                
                <div class="info-item"><span class="info-tag">Akustyka:</span> Dzięki monolitycznemu połączeniu nadbetonu z prefabrykatem, strop charakteryzuje się bardzo dobrą izolacyjnością akustyczną, spełniającą rygorystyczne normy budowlane.</div>
                
                <div class="info-item"><span class="info-tag">Logistyka:</span> Płyty o szerokości do 2.4m transportowane są bezpośrednio na budowę, gdzie za pomocą dźwigu trafiają od razu na docelowe miejsce w konstrukcji.</div>
            </div>
            <div class="scroll-controls">
                <div class="scroll-arrow arrow-up" id="arrowUp" onclick="scrollText(-100)">></div>
                <div class="scroll-arrow arrow-down" id="arrowDown" onclick="scrollText(100)">></div>
            </div>
        </div>
    </div>

    <div class="ar-container" id="ui-ar">
        <button class="btn-ar" onclick="restartExperience()">URUCHOM PREZENTACJĘ OD POCZĄTKU</button>
    </div>

    <div class="nav-guide" id="ui-nav">
        <div class="nav-item"><div class="mouse-icon mouse-left"></div><div class="nav-text">OBRÓT</div></div>
        <div class="nav-item"><div class="mouse-icon mouse-right"></div><div class="nav-text">RUCH</div></div>
        <div class="nav-item"><div class="mouse-icon mouse-scroll"></div><div class="nav-text">ZOOM</div></div>
    </div>

    <canvas id="canvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <script>
        let scene, camera, renderer, controls, currentModel, grid;
        let mainLight, hemiLight;
        
        let isAnimating = true;
        let isModelLoaded = false;
        let clipPlane = new THREE.Plane(new THREE.Vector3(0, 0, -1), 8);

        function scrollText(amount) {
            const container = document.getElementById('scrollContainer');
            container.scrollBy({ top: amount, behavior: 'smooth' });
        }

        function startExperience() {
            const overlay = document.getElementById('start-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => { overlay.style.display = 'none'; }, 500);

            if (isModelLoaded) {
                runIntroSequence();
            }
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020202);
            camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            // Kamera ustawiona blisko, aby model był od razu duży
            camera.position.set(25, 25, 30); 

            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.1; 
            
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap; 
            renderer.localClippingEnabled = true;

            grid = new THREE.GridHelper(50, 50, 0x333333, 0x111111);
            grid.position.y = -0.01;
            grid.material.opacity = 0;
            grid.material.transparent = true;
            scene.add(grid);

            // --- OŚWIETLENIE ---
            hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6); 
            scene.add(hemiLight);

            mainLight = new THREE.DirectionalLight(0xffffff, 2.8);
            mainLight.position.set(20, 30, 20);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 4096;
            mainLight.shadow.mapSize.height = 4096;
            mainLight.shadow.camera.near = 0.5;
            mainLight.shadow.camera.far = 100;
            const d = 25;
            mainLight.shadow.camera.left = -d;
            mainLight.shadow.camera.right = d;
            mainLight.shadow.camera.top = d;
            mainLight.shadow.camera.bottom = -d;
            mainLight.shadow.bias = -0.0001; 
            mainLight.shadow.normalBias = 0.02; 
            scene.add(mainLight);

            const fillLight = new THREE.PointLight(0xff5f2e, 1.5);
            fillLight.position.set(-10, 5, -10);
            scene.add(fillLight);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            loadModel();
            animate();
        }

        function loadModel() {
            new THREE.GLTFLoader().load('produkt.glb', (gltf) => {
                currentModel = gltf.scene;
                
                let concreteMeshes = [];
                let steelMeshes = [];
                let allMeshes = [];
                
                // 1. Zbieranie wszystkich meshów
                currentModel.traverse(n => {
                    if (n.isMesh) {
                        n.castShadow = true;
                        n.receiveShadow = true;
                        if(n.geometry) n.geometry.computeVertexNormals();

                        const name = n.name.toLowerCase();
                        const matName = n.material ? n.material.name.toLowerCase() : "";
                        const isSteel = name.includes('stal') || name.includes('steel') || 
                                      name.includes('zbroj') || name.includes('rebar') || 
                                      name.includes('pret') || name.includes('pręt') ||
                                      name.includes('krat') || matName.includes('metal');
                        const isConcrete = !isSteel;
                        
                        n.material = new THREE.MeshStandardMaterial({
                            color: n.material.color.clone(),
                            map: n.material.map,
                            roughness: isConcrete ? 0.7 : 0.3,
                            metalness: isConcrete ? 0.0 : 0.8,
                            transparent: true,
                            opacity: 0, 
                            clippingPlanes: [clipPlane],
                            side: THREE.DoubleSide
                        });
                        
                        n.userData.isConcrete = isConcrete;
                        n.userData.origPos = n.position.clone();
                        n.userData.origScale = n.scale.clone();
                        
                        if(!n.geometry.boundingBox) n.geometry.computeBoundingBox();
                        const center = (n.geometry.boundingBox.max.y + n.geometry.boundingBox.min.y) / 2;
                        n.userData.worldY = center + n.userData.origPos.y; 

                        if(isSteel) steelMeshes.push(n);
                        else concreteMeshes.push(n);
                        
                        allMeshes.push(n);
                    }
                });

                // 2. Określanie co jest GÓRĄ (Nadbeton + Stal górna)
                if (allMeshes.length > 0) {
                    let minC = Infinity, maxC = -Infinity;
                    concreteMeshes.forEach(m => {
                        if (m.userData.worldY < minC) minC = m.userData.worldY;
                        if (m.userData.worldY > maxC) maxC = m.userData.worldY;
                    });
                    
                    const threshold = minC + (maxC - minC) * 0.4;

                    allMeshes.forEach(m => {
                        if (m.userData.worldY > threshold) {
                            m.userData.isTopLayer = true; 
                        } else {
                            m.userData.isTopLayer = false;
                        }
                    });
                }

                // 3. Ustawianie pozycji startowych do animacji
                allMeshes.forEach(m => {
                    if (m.userData.isTopLayer) {
                        // GÓRA: Startuje wysoko (spada)
                        m.position.y += 15; 
                    } else {
                        // DÓŁ: Beton nisko, stal w miejscu
                        if(m.userData.isConcrete) {
                            m.position.y -= 5;
                        }
                    }
                });
                
                steelMeshes.sort((a, b) => a.userData.origPos.x - b.userData.origPos.x);

                currentModel.userData.steelMeshes = steelMeshes;
                currentModel.userData.concreteMeshes = concreteMeshes;

                currentModel.scale.set(2, 1.6, 2);

                scene.add(currentModel);
                isModelLoaded = true;
                
                const overlay = document.getElementById('start-overlay');
                if(overlay.style.display === 'none') {
                    runIntroSequence();
                }
            });
        }

        function runIntroSequence() {
            if(!currentModel) return;
            
            const steel = currentModel.userData.steelMeshes;
            const concrete = currentModel.userData.concreteMeshes;
            const all = [...steel, ...concrete];

            // 1. DOLNE ZBROJENIE (Fade In)
            steel.forEach(mesh => {
                if(!mesh.userData.isTopLayer) {
                    new TWEEN.Tween(mesh.material)
                        .to({opacity: 1}, 800) 
                        .easing(TWEEN.Easing.Quadratic.Out)
                        .start();
                }
            });

            // 2. DOLNY BETON (PŁYTA) - Wjazd z dołu
            const concreteDelay = 800;
            concrete.forEach(mesh => {
                if(!mesh.userData.isTopLayer) {
                    new TWEEN.Tween(mesh.position)
                        .to({y: mesh.userData.origPos.y}, 1000)
                        .delay(concreteDelay)
                        .easing(TWEEN.Easing.Cubic.Out)
                        .start();

                    new TWEEN.Tween(mesh.material)
                        .to({opacity: 1}, 1000)
                        .delay(concreteDelay)
                        .start();
                }
            });

            // 3. GÓRA (NADBETON + JEGO ZBROJENIE) - Spadają z góry
            // Zmieniono czas trwania na 2500ms (2.5s) aby zwolnić upadek
            const topDelay = 1800;
            all.forEach(mesh => {
                if(mesh.userData.isTopLayer) {
                    new TWEEN.Tween(mesh.position)
                        .to({y: mesh.userData.origPos.y}, 2500) // Wydłużony czas (zwolnienie)
                        .delay(topDelay)
                        .easing(TWEEN.Easing.Bounce.Out)
                        .start();

                    new TWEEN.Tween(mesh.material)
                        .to({opacity: 1}, 2500) // Wydłużony fade
                        .delay(topDelay)
                        .start();
                }
            });

            // 4. KAMERA
            new TWEEN.Tween(camera.position)
                .to({x: 20, y: 15, z: 25}, 5000)
                .easing(TWEEN.Easing.Cubic.InOut)
                .start();

            new TWEEN.Tween(grid.material).to({opacity: 0.3}, 2000).delay(1500).start();
            
            // UI pojawia się później, bo animacja trwa dłużej
            setTimeout(() => {
                isAnimating = false;
                controls.autoRotate = true;
                ["ui-panel", "info-panel", "ui-nav", "ui-ar"].forEach(id => {
                    document.getElementById(id).classList.add('visible');
                });
            }, 5000);
        }

        function toggleXRay(active) {
            if (!currentModel) return;

            const targetHemiIntensity = active ? 1.5 : 0.6;
            const targetMainIntensity = active ? 4.5 : 2.8;

            new TWEEN.Tween(hemiLight).to({ intensity: targetHemiIntensity }, 600).start();
            new TWEEN.Tween(mainLight).to({ intensity: targetMainIntensity }, 600).start();

            currentModel.traverse(n => {
                if (n.isMesh && n.userData.isConcrete) {
                    const targetOpacity = active ? 0.2 : 1.0;
                    const targetRoughness = active ? 0.1 : 0.7;
                    n.material.depthWrite = !active;
                    n.material.transparent = true;
                    n.material.needsUpdate = true;
                    new TWEEN.Tween(n.material)
                        .to({ opacity: targetOpacity, roughness: targetRoughness }, 600)
                        .easing(TWEEN.Easing.Quadratic.Out)
                        .start();
                }
            });
        }

        function updateClipping(val) { clipPlane.constant = parseFloat(val); }
        function restartExperience() { location.reload(); }

        function setVariant(h, btn) {
            if(isAnimating) return;
            new TWEEN.Tween(currentModel.scale).to({y: (h/20) * 2}, 800).easing(TWEEN.Easing.Back.Out).start();
            document.querySelectorAll('.variant-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function animate() {
            requestAnimationFrame(animate);
            TWEEN.update();
            controls.update();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>